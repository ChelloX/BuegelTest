<project default="makejar" name="XMLCONFIGURATION">

	<property file="../CommonLibs/build.properties" />
	
	<filter token="log4jversion" value="${LOG4JVERSION}" />

	<target name="compile" depends="generateXMLBeans">
		<javac srcdir="src" destdir="bin" compiler="extJavac" includeantruntime="false">
			<classpath>
				<pathelement path="../WoPeD-CORE/lib/woped-core-${COREVERSION}${SNAPSHOT}.jar" />
				<pathelement path="../WoPeD-Editor/lib/woped-editor-${EDITORVERSION}${SNAPSHOT}.jar" />
				<pathelement path="../WoPeD-Translations/lib/woped-translations-${TRANSLATIONVERSION}${SNAPSHOT}.jar" />
				<pathelement path="../CommonLibs/lib/log4j-${LOG4JVERSION}.jar" />
				<pathelement path="../CommonLibs/lib/xmlbeans-${XMLBEANSVERSION}.jar" />
				<pathelement path="lib/confBeans.jar" />
				<pathelement path="lib/metricsBeans.jar" />
			</classpath>
		</javac>
		<copy todir="bin/org/woped/config" file="src/org/woped/config/general/WoPeDconfig.xml"/>
		<copy todir="bin/org/woped/config/metrics" file="src/org/woped/config/metrics/WoPeDmetrics.xml"/>
	</target>
	
	<target name="makejar" depends="compile">
		<delete>
			<fileset file="lib/woped*.jar" />
		</delete>
		<jar destfile="lib/woped-xmlconfiguration-${XMLCONFIGURATIONVERSION}${SNAPSHOT}.jar">
			<fileset dir="bin" />
		</jar>
	</target>

	<target name="cleanup" depends="makejar">
		<delete file="lib/confBeans.jar" />
		<delete file="lib/metricsBeans.jar" />
	</target>

	<taskdef name="xmlbean" classname="org.apache.xmlbeans.impl.tool.XMLBean" classpath="../CommonLibs/lib/xmlbeansbuild-${XMLBEANSVERSION}.jar" />
	<!-- Please do not run this unless you really know what you're doing -->
	<target name="generateXMLBeans" unless="ConfigBeansUpToDate, MetricsBeansUpToDate">
		<echo message="Compiling the config schema..." />
		<xmlbean schema="src/org/woped/config/general/configuration.xsd" destfile="lib/confBeans.jar" debug="on" classpath="../CommonLibs/lib/xmlbeansbuild-${XMLBEANSVERSION}.jar" />
		<echo message="Compiling the metrics schema..." />
		<xmlbean schema="src/org/woped/config/metrics/metrics.xsd" destfile="lib/metricsBeans.jar" debug="on" classpath="../CommonLibs/lib/xmlbeansbuild-${XMLBEANSVERSION}.jar" />
	</target>
	
	<uptodate property="ConfigBeansUpToDate" srcfile="src/org/woped/config/general/configuration.xsd" targetfile="lib/confBeans.jar"/>
	<uptodate property="MetricsBeansUpToDate" srcfile="src/org/woped/config/metrics/metrics.xsd" targetfile="lib/metricsBeans.jar"/>
	
	<target name="clean">
		<delete dir="bin/org" />
	</target>

</project>
