<project default="makedistribution" name="INSTALLER">

	<tstamp />

	<property name="JGRAPHVERSION" value="5.4.4" />
	<property name="LOG4JVERSION" value="1.2.8" />
	<property name="WOPEDVERSION" value="1.0.0" />
	<property name="COREVERSION" value="1.0.0" />
	<property name="EDITORVERSION" value="1.0.0" />
	<property name="FILEINTERFACEVERSION" value="1.0.0" />
	<property name="GUIVERSION" value="1.0.0" />
	<property name="CONFIGURATIONVERSION" value="1.0.0" />
	<property name="SNAPSHOT" value="-beta" />

	<filter token="jgraphversion" value="${JGRAPHVERSION}" />
	<filter token="log4jversion" value="${LOG4JVERSION}" />
	<filter token="wopedversion" value="${WOPEDVERSION}${SNAPSHOT}" />
	<filter token="coreversion" value="${COREVERSION}${SNAPSHOT}" />
	<filter token="editorversion" value="${EDITORVERSION}${SNAPSHOT}" />
	<filter token="fileinterfaceversion" value="${FILEINTERFACEVERSION}${SNAPSHOT}" />
	<filter token="guiversion" value="${GUIVERSION}${SNAPSHOT}" />
	<filter token="configurationversion" value="${CONFIGURATIONVERSION}${SNAPSHOT}" />
	<filter token="builtstamp" value="${DSTAMP}" />

	<!--<taskdef resource="genjar.properties"/>	-->

	<target name="makedistribution" 
    depends="makedir, makesubprojects, setversion, copyfiles, makeinstaller, start, purge" />
	<!--	depends="makebindist, makesrcdist, purge" /> -->

	<target name="clean">
		<delete dir="dist" />
	</target>

	<target name="makedir" depends="clean">
		<mkdir dir="dist" />
		<mkdir dir="dist/lib" />
		<mkdir dir="dist/nets" />
		<mkdir dir="dist/doc" />
		<mkdir dir="dist/doc/html" />
		<mkdir dir="dist/doc/html/de" />
		<mkdir dir="dist/doc/html/en" />
		<mkdir dir="dist/doc/html/images" />
	</target>

	<target name="setversion">
		<copy file="../WoPeD-Editor/src/org/woped/editor/properties/Messages.properties" tofile="dist/Messages.properties" filtering="true" overwrite="true" />
		<copy file="../WoPeD-Editor/src/org/woped/editor/properties/Messages_de.properties" tofile="dist/Messages_de.properties" filtering="true" overwrite="true" />
		<copy file="dist/Messages.properties" tofile="../WoPeD-Editor/bin/org/woped/editor/properties/Messages.properties" />
		<copy file="dist/Messages_de.properties" tofile="../WoPeD-Editor/bin/org/woped/editor/properties/Messages_de.properties" />
	</target>

	<target name="copyfiles">
		<copy todir="dist/lib" file="../WoPeD-CORE/lib/woped-core-${COREVERSION}${SNAPSHOT}.jar" />
		<copy todir="dist/lib" file="../WoPeD-Editor/lib/woped-editor-${EDITORVERSION}${SNAPSHOT}.jar" />
		<copy todir="dist/lib" file="../WoPeD-FileInterface/lib/woped-fileinterface-${FILEINTERFACEVERSION}${SNAPSHOT}.jar" />
		<copy todir="dist/lib" file="../WoPeD-StandaloneRunner/lib/woped-gui-${GUIVERSION}${SNAPSHOT}.jar" />
		<copy todir="dist/lib" file="../WoPeD-XMLConfiguration/lib/woped-configuration-${CONFIGURATIONVERSION}${SNAPSHOT}.jar" />
		<copy todir="dist/lib" file="../WoPeD-FileInterface/lib/pnmlBeans.jar" />
		<copy todir="dist/lib" file="../WoPeD-FileInterface/lib/pnmlBeans_old.jar" />
		<copy todir="dist/lib" file="../WoPeD-XMLConfiguration/lib/confBeans.jar" />
		<copy todir="dist/lib" file="../CommonLibs/lib/jgraph-${JGRAPHVERSION}.jar" />
		<copy todir="dist/lib" file="../CommonLibs/lib/log4j-${LOG4JVERSION}.jar" />
		<copy todir="dist/lib" file="../CommonLibs/lib/xbean.jar" />
		<copy todir="dist/nets" file="build-tools/setup/Example.pnml" />

		<copy todir="dist" file="../WoPeD-XMLConfiguration/configuration.xml" />
	
		<copy todir="dist/doc/html/en">
			<fileset file="../WoPeD-StandaloneRunner/doc/doc/html/en/*.htm" />
		</copy>
		
		<copy todir="dist/doc/html/de">
			<fileset file="../WoPeD-StandaloneRunner/doc/doc/html/de/*.htm" />
		</copy>

		<copy file="../WoPeD-StandaloneRunner/doc/doc/html/woped-big.css" tofile="dist/doc/html/woped.css" />
		
		<copy todir="dist/doc/html/images">
			<fileset file="../WoPeD-StandaloneRunner/doc/doc/html/images/*.gif" />
			<fileset file="../WoPeD-StandaloneRunner/doc/doc/html/images/*.jpg" />
		</copy>

		<copy todir="dist">
			<fileset dir="build-tools/launcher/Windows" />
			<fileset dir="build-tools/launcher/Linux" />
			<fileset dir="build-tools/launcher/MacOS" />
			<fileset dir="build-tools/setup/Windows" />
			<fileset dir="build-tools/setup/Linux" />
			<fileset dir="build-tools/setup/MacOS" />
		</copy>

		<copy todir="dist" filtering="true" overwrite="true">
			<fileset file="build-tools/*.*" />
			<fileset file="build-tools/setup/install.xml" />
		</copy>

		<unzip src="build-tools/setup/izpack.zip" dest="dist" />
	</target>

	<target name="makejavadoc">
<!--		<javadoc packagenames="org.woped.*" sourcepath="src" destdir="doc/api-doc" />-->
	</target>

	<target name="makesubprojects">
		<ant antfile="../WoPeD-CORE/build.xml" dir="../WoPeD-CORE" />
		<ant antfile="../WoPeD-Editor/build.xml" dir="../WoPeD-Editor" />
		<ant antfile="../WoPeD-FileInterface/build.xml" dir="../WoPeD-FileInterface" />
		<ant antfile="../WoPeD-StandaloneRunner/build.xml" dir="../WoPeD-StandaloneRunner" />
		<ant antfile="../WoPeD-XMLConfiguration/build.xml" dir="../WoPeD-XMLConfiguration" />
	</target>
	
	<target name="makeinstaller">
		<jar destfile="dist/WoPeD.jar" manifest="dist/MANIFEST.mf">
			<fileset file="../WoPeD-StandaloneRunner/bin/org/woped/gui/RunWoPeD.class" />
		</jar>
		<exec dir="dist" executable="cmd">
			<arg line="/c launch4j.exe buildexe.cfg" />
		</exec>
		<exec dir="dist" executable="cmd">
			<arg line="/c java -jar lib\compiler.jar -HOME . install.xml -b . -o WoPeD-install.jar" />
		</exec>
		<exec dir="dist" executable="cmd">
			<arg line="/c launch4j.exe buildsetup.cfg" />
		</exec>

		<zip destfile="dist/WoPeD-install-windows-${WOPEDVERSION}.zip" basedir="dist" includes="WoPeD-install.exe" />

		<tar destfile="dist/WoPeD-install-linux-${WOPEDVERSION}.tgz" compression="gzip">
			<tarfileset dir="dist" mode="755">
				<include name="WoPeD-install" />
			</tarfileset>
			<tarfileset dir="dist">
				<include name="WoPeD-install.jar" />
			</tarfileset>
		</tar>

		<tar destfile="dist/WoPeD-install-macos-${WOPEDVERSION}.tgz" compression="gzip">
			<tarfileset dir="dist" mode="755">
				<include name="WoPeD-install.app" />
			</tarfileset>
			<tarfileset dir="dist">
				<include name="WoPeD-install.jar" />
			</tarfileset>
		</tar>
	</target>

	<target name="start">
		<exec dir="dist" executable="cmd">
			<arg line="/c WoPeD-install.exe" />
		</exec>
	</target>
	
	<target name="purge">
		<delete dir="dist/bin" />
		<delete dir="dist/nets" />
		<delete dir="dist/doc/html/images" />
		<delete dir="dist/doc/html/de" />
		<delete dir="dist/doc/html" />
		<delete dir="dist/doc" />
		<delete dir="dist/lib" />
		<delete dir="dist/build" />
		<delete dir="dist/WoPeD Starter.xcode" />
		<delete>
			<fileset dir="dist" excludes="WoPeD-install*.tgz 
		    							  WoPeD-install*.zip 
		    							  WoPeD-src*.zip
		    			    			  WoPeD-src*.tgz 
										  WoPeD-bin*.zip
		    							  WoPeD-bin*.tgz" />
		</delete>
		<delete dir="doc/api-doc" />
	</target>

	<!--
	<target name="makesrcdist" depends="copybuildtools, makejavadoc">
		<zip destfile="dist/WoPeD-src-${WOPEDVERSION}.zip">
			<zipfileset dir="." includes="src/**/*" />
			<zipfileset dir="." includes="lib/*.*" />
			<zipfileset dir="." includes="doc/**/*" />
			<zipfileset dir="." includes=".classpath" />
			<zipfileset dir="dist" includes="Readme.txt" />
			<zipfileset dir="dist" includes="License.txt" />
			<zipfileset dir="dist" includes="Changelog.txt" />
		</zip>
		<tar destfile="dist/WoPeD-src-${WOPEDVERSION}.tgz" compression="gzip">
			<tarfileset dir="." includes="src/**/*" />
			<tarfileset dir="." includes="lib/*.*" />
			<tarfileset dir="." includes="doc/**/*" />
			<tarfileset dir="." includes=".classpath" />
			<tarfileset dir="dist" includes="Readme.txt" />
			<tarfileset dir="dist" includes="License.txt" />
			<tarfileset dir="dist" includes="Changelog.txt" />
		</tar>
	</target>

	<target name="makebindist">
		<zip destfile="dist/WoPeD-bin-${WOPEDVERSION}.zip">
			<zipfileset dir="." includes="lib/*.*" />
			<zipfileset dir="dist" includes="WoPeD.jar" />
			<zipfileset dir="dist/lib" includes="WoPeDclasses.jar" prefix="lib/" />
			<zipfileset dir="dist" includes="Readme.txt" />
			<zipfileset dir="dist" includes="License.txt" />
			<zipfileset dir="dist" includes="Changelog.txt" />
		</zip>
		<tar destfile="dist/WoPeD-bin-${WOPEDVERSION}.tgz" compression="gzip">
			<tarfileset dir="." includes="lib/*.*" />
			<tarfileset dir="dist/lib" includes="WoPeDclasses.jar" prefix="lib/" />
			<tarfileset dir="dist" includes="WoPeD.jar" />
			<tarfileset dir="dist" includes="Readme.txt" />
			<tarfileset dir="dist" includes="License.txt" />
			<tarfileset dir="dist" includes="Changelog.txt" />
		</tar>
	</target>
-->
	<!--<target name="genjar" depends="copylibs">
		<unjar dest="dist/genjarsrc">
			<fileset dir="dist/lib"/>
		</unjar>
		<genjar destdir="dist/genjar">
			<classpath>
				<pathelement path="dist/genjarsrc"/>
				<pathelement path="bin"/>
			</classpath>
			<class name="org.woped.RunWoPeD"/>
			<class name="org.apache.log4j.ConsoleAppender"/>
			<class name="org.apache.log4j.PatternLayout"/>
			<class name="org.apache.log4j.RollingFileAppender"/>
			<class name="org.apache.xmlbeans.impl.schema.SchemaTypeLoaderImpl"/>
			<class name="javax.xml.namespace.QName"/>
			<class name="org.apache.xmlbeans.impl.store.Root"/>
			<classfilter>
				<exclude name="org.w3c.dom."/>
				<exclude name="org.xml.sax."/>
			</classfilter>
		</genjar>
		<copy todir="dist/genjar">
			<fileset dir="dist/genjarsrc">
				<exclude name="**//**.java"/>
				<exclude name="**//**.class"/>
			</fileset>
		</copy>
		<jar destfile="dist/gen.jar" compress="true">
			<fileset dir="dist/genjar">
				<exclude name="org/woped/*"/>
				<exclude name="config/woped/org/*"/>
			</fileset>
		</jar>
	</target>-->
	
<!-- Please do not run this unless you really know what you're doing -->	
<!--	<taskdef name="xmlbean" classname="org.apache.xmlbeans.impl.tool.XMLBean" classpath="resources/xbean_orig.jar" />	
	<target name="generateConfigXMLBeans">
		<echo message="Compiling the config schema..." />
		<xmlbean schema="src/org/woped/config/configuration.xsd" destfile="lib/confBeans.jar" debug="on" classpath="resources/xbean_orig.jar" />
	</target>
	<target name="generatePnmlXMLBeans">
		<echo message="Compiling the PNML schema..." />
		<xmlbean schema="src/org/woped/pnml/pnml_wf.xsd" destfile="lib/pnmlBeans.jar" debug="on" classpath="resources/xbean_orig.jar" />
	</target>
	<target name="generateOldPnmlXMLBeans">
		<echo message="Compiling the old PNML schema..." />
		<xmlbean schema="src/org/woped/pnml/pnml_wf_old.xsd" destfile="lib/pnmlBeans_old.jar" debug="on" classpath="resources/xbean_orig.jar" />
	</target>-->

</project>
