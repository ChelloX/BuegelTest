<project default="makedistribution" name="SERVER">

	<tstamp />
	<property file="../CommonLibs/build.properties" />

	<filter token="jgraphversion" value="${JGRAPHVERSION}" />
	<filter token="log4jversion" value="${LOG4JVERSION}" />
	<filter token="flanaganversion" value="${FLANAGANVERSION}" />
	<filter token="wopedversion" value="${WOPEDVERSION}${SNAPSHOT}" />
	<filter token="coreversion" value="${COREVERSION}${SNAPSHOT}" />
	<filter token="editorversion" value="${EDITORVERSION}${SNAPSHOT}" />
	<filter token="qualanaversion" value="${QUALANAVERSION}${SNAPSHOT}" />
	<filter token="fileinterfaceversion" value="${FILEINTERFACEVERSION}${SNAPSHOT}" />
	<filter token="guiversion" value="${GUIVERSION}${SNAPSHOT}" />
	<filter token="quantanaversion" value="${QUANTANAVERSION}${SNAPSHOT}" />
	<filter token="configurationversion" value="${CONFIGURATIONVERSION}${SNAPSHOT}" />
	<filter token="translationversion" value="${TRANSLATIONVERSION}${SNAPSHOT}" />
	<filter token="bpelexportversion" value="${BPELEXPORTVERSION}${SNAPSHOT}" />
	<filter token="builtstamp" value="${DSTAMP}" />

	<!--<taskdef resource="genjar.properties"/>	-->

	<target name="makedistribution" depends="compile, makesubprojects, makedir, setversion, copyfiles, buildjar, makeInstallApplet, purge" />
	<!-- makesrcdist -->
	<target name="clean">
		<delete dir="dist" />
	</target>

	<target name="makedir" depends="clean">
		<mkdir dir="dist" />
		<mkdir dir="dist/lib" />
		<mkdir dir="dist/nets" />
		<mkdir dir="dist/html" />
		<mkdir dir="dist/html/de" />
		<mkdir dir="dist/html/en" />
		<mkdir dir="dist/html/images" />
		<mkdir dir="dist/html/images/icons" />
		<mkdir dir="dist/html/images/icons/tango" />
		<mkdir dir="dist/html/images/elements" />
	</target>

	<target name="setversion">
		<copy file="../WoPeD-Translations/src/org/woped/translations/Messages.properties" tofile="dist/Messages.properties" filtering="true" overwrite="true" />
		<copy file="../WoPeD-Translations/src/org/woped/translations/Messages_de.properties" tofile="dist/Messages_de.properties" filtering="true" overwrite="true" />
		<copy file="dist/Messages.properties" tofile="../WoPeD-Translations/bin/org/woped/translations/Messages.properties" />
		<copy file="dist/Messages_de.properties" tofile="../WoPeD-Translations/bin/org/woped/translations/Messages_de.properties" />
		<copy file="log4j.xml" tofile="../WoPeD-StandaloneRunner/bin/org/woped/gui/utilities/log4j.xml" />
	</target>
	
	<target name="makeInstallApplet">
			<copy todir="dist/installApplet/html">
				<fileset dir="dist/html" />
			</copy>
			<copy todir="dist/installApplet/lib">
				<fileset dir="dist/lib" />
			</copy>
			<copy todir="dist/installApplet">
				<fileset file="dist/woped-server.jar" />
			</copy>
			<zip destfile="dist/woped-server.zip">
				<zipfileset dir="dist/installApplet" />
			</zip>
	</target>


	<target name="copyfiles">
		<copy todir="dist/nets" file="build-tools/setup/Example.pnml" />
		<copy todir="dist/lib" file="../WoPeD-FileInterface/lib/pnmlBeans.jar" />
		<copy todir="dist/lib" file="../WoPeD-FileInterface/lib/pnmlBeans_old.jar" />
		<copy todir="dist/lib" file="../WoPeD-XMLConfiguration/lib/confBeans.jar" />
		<copy todir="dist" file="../WoPeD-StandaloneRunner/WofJava.dll" />
		<copy todir="dist/lib" file="../CommonLibs/lib/jgraph-${JGRAPHVERSION}.jar" />
		<copy todir="dist/lib" file="../CommonLibs/lib/log4j-${LOG4JVERSION}.jar" />
		<copy todir="dist/lib" file="../CommonLibs/lib/flanagan-${FLANAGANVERSION}.jar" />
		<copy todir="dist/lib" file="../CommonLibs/lib/xbean.jar" />
		<copy todir="dist/lib" file="lib/mysql-connector-java-5.1.5-bin.jar" />
		
		
		<copy todir="dist/html/en">
			<fileset file="../WoPeD-StandaloneRunner/doc/html/en/*.htm" />
		</copy>

		<copy todir="dist/html/de">
			<fileset file="../WoPeD-StandaloneRunner/doc/html/de/*.htm" />
		</copy>

		<copy file="../WoPeD-StandaloneRunner/doc/html/woped.css" tofile="dist/html/woped.css" />

		<copy todir="dist/html/images">
			<fileset file="../WoPeD-StandaloneRunner/doc/html/images/*.gif" />
			<fileset file="../WoPeD-StandaloneRunner/doc/html/images/*.jpg" />
			<fileset file="../WoPeD-StandaloneRunner/doc/html/images/*.png" />
		</copy>

		<copy todir="dist/html/images/elements">
			<fileset file="../WoPeD-StandaloneRunner/doc/html/images/elements/*.gif" />
		</copy>

		<copy todir="dist/html/images/icons">
			<fileset file="../WoPeD-StandaloneRunner/doc/html/images/icons/*.gif" />
			<fileset file="../WoPeD-StandaloneRunner/doc/html/images/icons/*.jpg" />
			<fileset file="../WoPeD-StandaloneRunner/doc/html/images/icons/*.png" />
		</copy>

		<copy todir="dist/html/images/icons/tango">
			<fileset file="../WoPeD-StandaloneRunner/doc/html/images/icons/tango/*.gif" />
		</copy>

		<copy todir="dist" filtering="true" overwrite="true">
			<fileset file="build-tools/*.*" />
			<fileset file="build-tools/setup/install.xml" />
		</copy>

	</target>

	<target name="buildjar">
		<jar destfile="dist/woped-server.jar" manifest="dist/MANIFEST-SERVER.mf">
			<fileset dir="../WoPeD-CORE/bin" />
			<fileset dir="../WoPeD-BPELExport/bin" />
			<fileset dir="../WoPeD-Editor/bin" />
			<fileset dir="../WoPeD-FileInterface/bin" />
			<fileset dir="../WoPeD-StandaloneRunner/bin" />
			<fileset dir="../WoPeD-QuantAnalysis/bin" />
			<fileset dir="../WoPeD-QualAnalysis/bin" />
			<fileset dir="../WoPeD-Translations/bin" />
			<fileset dir="../WoPeD-XMLConfiguration/bin" />
			<fileset dir="bin" />
		</jar>		
	</target>

	<target name="makesubprojects">
		<ant antfile="../WoPeD-CORE/build.xml" dir="../WoPeD-CORE" />
		<ant antfile="../WoPeD-BPELExport/build.xml" dir="../WoPeD-BPELExport" />
		<ant antfile="../WoPeD-Editor/build.xml" dir="../WoPeD-Editor" />
		<ant antfile="../WoPeD-FileInterface/build.xml" dir="../WoPeD-FileInterface" />
		<ant antfile="../WoPeD-XMLConfiguration/build.xml" dir="../WoPeD-XMLConfiguration" />
		<ant antfile="../WoPeD-StandaloneRunner/build.xml" dir="../WoPeD-StandaloneRunner" />
		<ant antfile="../WoPeD-QuantAnalysis/build.xml" dir="../WoPeD-QuantAnalysis" />
		<ant antfile="../WoPeD-QualAnalysis/build.xml" dir="../WoPeD-QualAnalysis" />
		<ant antfile="../WoPeD-Translations/build.xml" dir="../WoPeD-Translations" />
	</target>

		
	<target name="compile">
			<javac srcdir="src" destdir="bin" compiler="extJavac"/>			
	</target>

	<target name="purge">
		<delete dir="dist/bin" />
		<delete dir="dist/nets" />
		<delete dir="dist/html/images" />
		<delete dir="dist/html/de" />
		<delete dir="dist/html/en" />
		<delete dir="dist/html" />
		<delete dir="dist/lib" />
		<delete dir="dist/build" />
		<delete dir="dist/installApplet/lib"/>
		<delete dir="dist/installApplet/html"/>
		<delete dir="dist/installApplet/"/>
		<delete dir="dist/WoPeD Starter.xcode" />
		<delete>
			<fileset dir="dist" excludes="WoPeD-Applet-${WOPEDVERSION}.zip, woped-server.zip" />
		</delete>
	</target>

</project>
